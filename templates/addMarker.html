{% extends 'base.html' %}
{% load static %}
{% block title %}Add Marker{% endblock %}
{% block head %}
<style>
#contener{
  position: absolute;
  left: 25%;
  max-height: 0px;
  margin-top: 10px;
}
#map{
  position: absolute;
  width: 50%;
  height: 500px;
  top: 56px;
  right: 0;
}
</style>
{% endblock %}

{% block main %}
<div id="contener" class="translate-middle">
<form method="POST" class="form-group">
    {% csrf_token %}
    <label class="form-label">Location</label>
    <div class="input-group mb-3">
      <input type="text" name="address" id="address" class="form-control" placeholder="WrocÅ‚aw" aria-describedby="button-addon" required>
      <input type="button" id="button-addon" class="btn btn-outline-secondary" onclick="codeAddress()" value="Find">
      <input id="location" name="location" class="d-none">
    </div>
    <div class="mb-3">
        <label class="form-label">Title</label>
        <input type="text" name="title" id="title" class="form-control" placeholder="Title..." required>
    </div>
    <div class="mb-3">
        <label class="form-label">Content</label>
        <textarea name="content" id="content" class="form-control" placeholder="Content..." required></textarea>
      </div>
    <button id="submit" type="submit" class="btn btn-success" >Add</button>
  </form>
</div>
  <div id="map"></div>
  <script>
    let geocoder;
    let map;
    function initialize() {
      geocoder = new google.maps.Geocoder();
      const mapOptions = {
        zoom: 8,
        center: {lat: 51.1079, lng: 17.0385}
      }
      map = new google.maps.Map(document.getElementById('map'), mapOptions);
    }

    function codeAddress() {
      const address = document.getElementById('address').value;
      geocoder.geocode( { 'address': address}, function(results, status) {
        document.getElementById('location').value = results[0].geometry.location;
        if (status == 'OK') {
          map.setCenter(results[0].geometry.location);
          const marker = new google.maps.Marker({
              map: map,
              position: results[0].geometry.location
          });
        } else {
          alert('Geocode was not successful for the following reason: ' + status);
        }
      });
    }
  </script>
  <script async
    src="https://maps.googleapis.com/maps/api/js?key={{api_key}}&libraries=places&callback=initialize">
</script>
{% endblock %}